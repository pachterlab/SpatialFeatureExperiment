<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Find spatial neighborhood graph — findSpatialNeighbors,SpatialFeatureExperiment-method • SpatialFeatureExperiment</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Find spatial neighborhood graph — findSpatialNeighbors,SpatialFeatureExperiment-method"><meta name="description" content="This function wraps all spatial neighborhood graphs implemented in the
package spdep for the SpatialFeatureExperiment (SFE) class, to
find spatial neighborhood graphs for the entities represented by columns or
rows of the gene count matrix in the SFE object or spatial entities in the
annotGeometries field of the SFE object. Results are stored as
listw objects in the spatialGraphs field of the SFE object, as
listw is used in many methods that facilitate the spatial neighborhood
graph in the spdep, spatialreg, and adespatial. The edge
weights of the graph in the listw object are by default style W (see
nb2listw) and the unweighted neighbor list is in the
neighbours field of the listw object."><meta property="og:description" content="This function wraps all spatial neighborhood graphs implemented in the
package spdep for the SpatialFeatureExperiment (SFE) class, to
find spatial neighborhood graphs for the entities represented by columns or
rows of the gene count matrix in the SFE object or spatial entities in the
annotGeometries field of the SFE object. Results are stored as
listw objects in the spatialGraphs field of the SFE object, as
listw is used in many methods that facilitate the spatial neighborhood
graph in the spdep, spatialreg, and adespatial. The edge
weights of the graph in the listw object are by default style W (see
nb2listw) and the unweighted neighbor list is in the
neighbours field of the listw object."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SpatialFeatureExperiment</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.8.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/seurat_sfe_coerce.html">Seurat_to_SFE</a></li>
    <li><a class="dropdown-item" href="../articles/SFE.html">Introduction to the SpatialFeatureExperiment class</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pachterlab/SpatialFeatureExperiment/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Find spatial neighborhood graph</h1>
      <small class="dont-index">Source: <a href="https://github.com/pachterlab/SpatialFeatureExperiment/blob/documentation/R/graph_wrappers.R" class="external-link"><code>R/graph_wrappers.R</code></a></small>
      <div class="d-none name"><code>findSpatialNeighbors-SpatialFeatureExperiment-method.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function wraps all spatial neighborhood graphs implemented in the
package <code>spdep</code> for the <code>SpatialFeatureExperiment</code> (SFE) class, to
find spatial neighborhood graphs for the entities represented by columns or
rows of the gene count matrix in the SFE object or spatial entities in the
<code>annotGeometries</code> field of the SFE object. Results are stored as
<code>listw</code> objects in the <code>spatialGraphs</code> field of the SFE object, as
<code>listw</code> is used in many methods that facilitate the spatial neighborhood
graph in the <code>spdep</code>, <code>spatialreg</code>, and <code>adespatial</code>. The edge
weights of the graph in the <code>listw</code> object are by default style W (see
<code>nb2listw</code>) and the unweighted neighbor list is in the
<code>neighbours</code> field of the <code>listw</code> object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'SpatialFeatureExperiment'</span></span>
<span><span class="fu">findSpatialNeighbors</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  sample_id <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"spatialCoords"</span>,</span>
<span>  MARGIN <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tri2nb"</span>, <span class="st">"knearneigh"</span>, <span class="st">"dnearneigh"</span>, <span class="st">"gabrielneigh"</span>, <span class="st">"relativeneigh"</span>,</span>
<span>    <span class="st">"soi.graph"</span>, <span class="st">"poly2nb"</span><span class="op">)</span>,</span>
<span>  dist_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"idw"</span>, <span class="st">"exp"</span>, <span class="st">"dpd"</span><span class="op">)</span>,</span>
<span>  glist <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"raw"</span>, <span class="st">"W"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"U"</span>, <span class="st">"minmax"</span>, <span class="st">"S"</span><span class="op">)</span>,</span>
<span>  nn_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bioc"</span>, <span class="st">"spdep"</span><span class="op">)</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  dmax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu">SerialParam</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  BNPARAM <span class="op">=</span> <span class="fu">KmknnParam</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  zero.policy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code><a href="SpatialFeatureExperiment.html">SpatialFeatureExperiment</a></code> object.</p></dd>


<dt id="arg-sample-id">sample_id<a class="anchor" aria-label="anchor" href="#arg-sample-id"></a></dt>
<dd><p>Which sample(s) in the SFE object to use for the graph. Can
also be "all", which means this function will compute the graph for all
samples independently.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Name of the geometry associated with the MARGIN of interest for
which to compute the graph.</p></dd>


<dt id="arg-margin">MARGIN<a class="anchor" aria-label="anchor" href="#arg-margin"></a></dt>
<dd><p>Just like in <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></code>, where 1 stands for row, 2
stands for column. Here, in addition, 3 stands for annotation, to query the
<code><a href="annotGeometries.html">annotGeometries</a></code>, such as nuclei segmentation in a Visium data</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Name of function in the package <code>spdep</code> to use to find the
spatial neighborhood graph.</p></dd>


<dt id="arg-dist-type">dist_type<a class="anchor" aria-label="anchor" href="#arg-dist-type"></a></dt>
<dd><p>Type of distance-based weight. "none" means not using
distance-based weights; the edge weights of the spatial neighborhood graph
will be entirely determined by the <code>style</code> argument. "idw" means
inverse distance weighting. "exp" means exponential decay. "dpd" means
double-power distance weights. See <code><a href="https://r-spatial.github.io/spdep/reference/nb2listwdist.html" class="external-link">nb2listwdist</a></code> for
details.</p></dd>


<dt id="arg-glist">glist<a class="anchor" aria-label="anchor" href="#arg-glist"></a></dt>
<dd><p>list of general weights corresponding to neighbours</p></dd>


<dt id="arg-style">style<a class="anchor" aria-label="anchor" href="#arg-style"></a></dt>
<dd><p><code>style</code> can take values “W”, “B”, “C”, “U”, “minmax” and “S”</p></dd>


<dt id="arg-nn-method">nn_method<a class="anchor" aria-label="anchor" href="#arg-nn-method"></a></dt>
<dd><p>Method to find k nearest neighbors and distance based
neighbors. Can be either "bioc" or "spdep". For "bioc", methods from
<code>BiocNeighbors</code> are used. For "spdep", methods from the <code>spdep</code>
package are used. The "bioc" option is more scalable to larger datasets and
supports multithreading.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Only relevant when <code>dist_type = "dpd"</code>.</p></dd>


<dt id="arg-dmax">dmax<a class="anchor" aria-label="anchor" href="#arg-dmax"></a></dt>
<dd><p>Only relevant when <code>dist_type = "dpd"</code>.</p></dd>


<dt id="arg-bpparam">BPPARAM<a class="anchor" aria-label="anchor" href="#arg-bpparam"></a></dt>
<dd><p>A <code>BiocParallelParam</code> object for multithreading.
Only used for k nearest neighbor and distance based neighbor with
<code>nn_method = "bioc"</code>.</p></dd>


<dt id="arg-bnparam">BNPARAM<a class="anchor" aria-label="anchor" href="#arg-bnparam"></a></dt>
<dd><p>A <code>BiocNeighborParam</code> object specifying the
algorithm to find k nearest neighbors and distance based neighbors with
<code>nn_method = "bioc"</code>. For distance based neighbors, only
<code>KmknnParam</code> and <code>VptreeParam</code> are applicable.</p></dd>


<dt id="arg-zero-policy">zero.policy<a class="anchor" aria-label="anchor" href="#arg-zero-policy"></a></dt>
<dd><p>default NULL, use global option value; if FALSE stop with error for any empty neighbour sets, if TRUE permit the weights list to be formed with zero-length weights vectors</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Extra arguments passed to the <code>spdep</code> function stated in the
<code>method</code> argument, such as <code>k</code>, <code>use_kd_tree</code>, <code>d1</code>,
<code>d2</code>, <code>nnmult</code>, <code>sym</code>, and <code>quadsegs</code>. Note that any
arguments about using longitude and latitude, which are irrelevant, are
ignored.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For one sample, then a <code>listw</code> object representing the graph,
  with an attribute "method" recording the function used to build the graph,
  its arguments, and information about the geometry for which the graph was
  built. The attribute is used to reconstruct the graphs when the SFE object
  is subsetted since some nodes in the graph will no longer be present. If
  sample_id = "all" or has length &gt; 1, then a named list of <code>listw</code>
  objects, whose names are the sample_ids. To add the list for multiple
  samples to a SFE object, specify the <code>name</code> argument in the
  <code><a href="spatialGraphs.html">spatialGraphs</a></code> replacement method, so graph of the same name
  will be added to the SFE object for each sample.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p><code>style = "raw"</code> is only applicable when <code>dist_type</code> is not
  "none". If <code>dist_type = "none"</code> and <code>style = "raw"</code>, then style
  will default to "W". Using distance based weights does not supplant finding
  a spatial neighborhood graph. The spatial neighborhood graph is first found
  and then its edges weighted based on distance in this function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pachterlab/SFEData" class="external-link">SFEData</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sfe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SFEData/man/McKellarMuscleData.html" class="external-link">McKellarMuscleData</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"small"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> see ?SFEData and browseVignettes('SFEData') for documentation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> loading from cache</span>
<span class="r-in"><span><span class="co"># sample_id is optional when only one sample is present</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">findSpatialNeighbors</span><span class="op">(</span><span class="va">sfe</span>, sample_id <span class="op">=</span> <span class="st">"Vis5A"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">g</span>, <span class="st">"method"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $FUN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "findSpatialNeighbors"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $package</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $package[[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "SpatialFeatureExperiment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $package[[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "1.8.3"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $args</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $args$method</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "tri2nb"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $args$dist_type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "none"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $args$style</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "W"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $args$alpha</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $args$zero.policy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $args$sample_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Vis5A"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $args$type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "spatialCoords"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $args$MARGIN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># Returns named list for multiple samples</span></span></span>
<span class="r-in"><span><span class="va">sfe2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SFEData/man/McKellarMuscleData.html" class="external-link">McKellarMuscleData</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"small2"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> see ?SFEData and browseVignettes('SFEData') for documentation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> loading from cache</span>
<span class="r-in"><span><span class="va">sfe_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sfe</span>, <span class="va">sfe2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu">findSpatialNeighbors</span><span class="op">(</span><span class="va">sfe</span>, sample_id <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lambda Moses, Alik Huseynov, Lior Pachter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

