<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Aggregate transcript spots from file — aggregateTx • SpatialFeatureExperiment</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregate transcript spots from file — aggregateTx"><meta name="description" content="This function reads the transcript spot file from the standard output of the
commercial technologies (not GeoParquet) for spatial aggregation where the
spots are assigned to polygons such as cells or spatial bins. Presets for
Xenium, MERFISH, and CosMX are available. For Vizgen and Xenium, the images
can be added when add_images = TRUE."><meta property="og:description" content="This function reads the transcript spot file from the standard output of the
commercial technologies (not GeoParquet) for spatial aggregation where the
spots are assigned to polygons such as cells or spatial bins. Presets for
Xenium, MERFISH, and CosMX are available. For Vizgen and Xenium, the images
can be added when add_images = TRUE."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SpatialFeatureExperiment</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.8.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/seurat_sfe_coerce.html">Seurat_to_SFE</a></li>
    <li><a class="dropdown-item" href="../articles/SFE.html">Introduction to the SpatialFeatureExperiment class</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pachterlab/SpatialFeatureExperiment/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Aggregate transcript spots from file</h1>
      <small class="dont-index">Source: <a href="https://github.com/pachterlab/SpatialFeatureExperiment/blob/documentation/R/aggregate.R" class="external-link"><code>R/aggregate.R</code></a></small>
      <div class="d-none name"><code>aggregateTx.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function reads the transcript spot file from the standard output of the
commercial technologies (not GeoParquet) for spatial aggregation where the
spots are assigned to polygons such as cells or spatial bins. Presets for
Xenium, MERFISH, and CosMX are available. For Vizgen and Xenium, the images
can be added when <code>add_images = TRUE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">aggregateTx</span><span class="op">(</span></span>
<span>  <span class="va">file</span>,</span>
<span>  df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_id <span class="op">=</span> <span class="st">"sample01"</span>,</span>
<span>  spatialCoordsNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"Z"</span><span class="op">)</span>,</span>
<span>  gene_col <span class="op">=</span> <span class="st">"gene"</span>,</span>
<span>  phred_col <span class="op">=</span> <span class="st">"qv"</span>,</span>
<span>  min_phred <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  flip_geometry <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cellsize <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  square <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  flat_topped <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  new_geometry_name <span class="op">=</span> <span class="st">"bins"</span>,</span>
<span>  unit <span class="op">=</span> <span class="st">"micron"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">aggregateTxTech</span><span class="op">(</span></span>
<span>  <span class="va">data_dir</span>,</span>
<span>  df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tech <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vizgen"</span>, <span class="st">"Xenium"</span>, <span class="st">"CosMX"</span><span class="op">)</span>,</span>
<span>  sample_id <span class="op">=</span> <span class="st">"sample01"</span>,</span>
<span>  image <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_phred <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  flip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geometry"</span>, <span class="st">"image"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  max_flip <span class="op">=</span> <span class="st">"50 MB"</span>,</span>
<span>  cellsize <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  square <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  flat_topped <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  new_geometry_name <span class="op">=</span> <span class="st">"bins"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-file">file<a class="anchor" aria-label="anchor" href="#arg-file"></a></dt>
<dd><p>File with the transcript spot coordinates. Should be one row per
spot when read into R and should have columns for coordinates on each axis,
gene the transcript is assigned to, and optionally cell the transcript is
assigned to. Must be csv, tsv, or parquet.</p></dd>


<dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>If the file is already loaded into memory, a data frame (sf) with
columns for the x, y, and optionally z coordinates and gene assignment of
each transcript spot. If specified, then argument <code>file</code> will be
ignored.</p></dd>


<dt id="arg-by">by<a class="anchor" aria-label="anchor" href="#arg-by"></a></dt>
<dd><p>A <code>sfc</code> or <code>sf</code> object for spatial aggregation.</p></dd>


<dt id="arg-sample-id">sample_id<a class="anchor" aria-label="anchor" href="#arg-sample-id"></a></dt>
<dd><p>Which sample in the SFE object the transcript spots should
be added to.</p></dd>


<dt id="arg-spatialcoordsnames">spatialCoordsNames<a class="anchor" aria-label="anchor" href="#arg-spatialcoordsnames"></a></dt>
<dd><p>Column names for the x, y, and optionally z
coordinates of the spots. The defaults are for Vizgen.</p></dd>


<dt id="arg-gene-col">gene_col<a class="anchor" aria-label="anchor" href="#arg-gene-col"></a></dt>
<dd><p>Column name for genes.</p></dd>


<dt id="arg-phred-col">phred_col<a class="anchor" aria-label="anchor" href="#arg-phred-col"></a></dt>
<dd><p>Column name for Phred scores of the spots.</p></dd>


<dt id="arg-min-phred">min_phred<a class="anchor" aria-label="anchor" href="#arg-min-phred"></a></dt>
<dd><p>Minimum Phred score to keep spot. By default 20, the
conventional threshold indicating "acceptable", meaning that there's 1<!-- % -->
chance that the spot was decoded in error.</p></dd>


<dt id="arg-flip-geometry">flip_geometry<a class="anchor" aria-label="anchor" href="#arg-flip-geometry"></a></dt>
<dd><p>Logical, whether to flip the transcript spot geometries
to match the images if added later.</p></dd>


<dt id="arg-cellsize">cellsize<a class="anchor" aria-label="anchor" href="#arg-cellsize"></a></dt>
<dd><p>numeric of length 1 or 2 with target cellsize: for square or rectangular cells the width and height, for hexagonal cells the distance between opposite edges (edge length is cellsize/sqrt(3)). A length units object can be passed, or an area unit object with area size of the square or hexagonal cell.</p></dd>


<dt id="arg-square">square<a class="anchor" aria-label="anchor" href="#arg-square"></a></dt>
<dd><p>logical; if <code>FALSE</code>, create hexagonal grid</p></dd>


<dt id="arg-flat-topped">flat_topped<a class="anchor" aria-label="anchor" href="#arg-flat-topped"></a></dt>
<dd><p>logical; if <code>TRUE</code> generate flat topped hexagons, else generate pointy topped</p></dd>


<dt id="arg-new-geometry-name">new_geometry_name<a class="anchor" aria-label="anchor" href="#arg-new-geometry-name"></a></dt>
<dd><p>Name to give to the new <code>colGeometry</code> in the
output. Defaults to "bins".</p></dd>


<dt id="arg-unit">unit<a class="anchor" aria-label="anchor" href="#arg-unit"></a></dt>
<dd><p>Unit the coordinates are in, either microns or pixels in full
resolution image.</p></dd>


<dt id="arg-data-dir">data_dir<a class="anchor" aria-label="anchor" href="#arg-data-dir"></a></dt>
<dd><p>Top level output directory.</p></dd>


<dt id="arg-tech">tech<a class="anchor" aria-label="anchor" href="#arg-tech"></a></dt>
<dd><p>Which technology whose output to read, must be one of "Vizgen",
"Xenium", or "CosMX" though more technologies may be added later.</p></dd>


<dt id="arg-image">image<a class="anchor" aria-label="anchor" href="#arg-image"></a></dt>
<dd><p>String, which image(s) to add to the output SFE object. Not
applicable to CosMX. See <code><a href="readVizgen.html">readVizgen</a></code> and
<code><a href="readXenium.html">readXenium</a></code> for options and multiple images can be specified.
If <code>NULL</code>, then the default from the read function for the technology
will be used.</p></dd>


<dt id="arg-flip">flip<a class="anchor" aria-label="anchor" href="#arg-flip"></a></dt>
<dd><p>Logical, whether to flip the geometry to match image. Here the y
coordinates are simply set to -y, so the original bounding box is not
preserved. This is consistent with <code>readVizgen</code> and <code>readXenium</code>.</p></dd>


<dt id="arg-max-flip">max_flip<a class="anchor" aria-label="anchor" href="#arg-max-flip"></a></dt>
<dd><p>Maximum size of the image allowed to flip the image. Because
the image will be loaded into memory to be flipped. If the image is larger
than this size then the coordinates will be flipped instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A SFE object with count matrix for number of spots of each gene in
  each geometry. Geometries with no spot are removed.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The resulting SFE object often includes geometries (e.g. grid cells)
  outside tissue, because there can be transcript spots detected outside the
  tissue. Also, bins at the edge of the tissue that don't fully overlap with
  the tissue will have lower transcript counts; this may have implications to
  downstream spatial analyses.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lambda Moses, Alik Huseynov, Lior Pachter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

